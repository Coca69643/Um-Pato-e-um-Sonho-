<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Um Pato e um Sonho - V2.5</title>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; touch-action: none; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #111; font-family: sans-serif; position: fixed; }
        canvas { display: block; image-rendering: pixelated; width: 100vw; height: 100vh; z-index: 1; }

        /* CAMADAS DE INTERFACE */
        .layer { position: fixed; inset: 0; pointer-events: none; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .interactive { pointer-events: auto !important; }
        .hidden { display: none !important; }

        /* ESTILO DOS BOT√ïES */
        .btn-ui { background: #22c55e; color: white; border: none; padding: 15px; border-radius: 12px; font-weight: bold; width: 250px; margin: 10px; box-shadow: 0 4px #166534; cursor: pointer; pointer-events: auto; }
        .btn-cancel { background: #ef4444; box-shadow: 0 4px #991b1b; }

        /* HUD & HOTBAR */
        .hud-top { position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.8); padding: 10px 15px; border-radius: 12px; color: white; border: 1px solid #444; z-index: 50; }
        
        #hotbar { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 18px; pointer-events: auto; z-index: 80; }
        .slot { width: 55px; height: 55px; background: #222; border: 3px solid #444; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 26px; position: relative; transition: 0.2s; }
        .slot.active { border-color: #fb923c; background: #333; transform: scale(1.1); }
        .slot-count { position: absolute; bottom: 2px; right: 5px; font-size: 12px; font-weight: bold; color: #fff; }

        /* CONTROLES */
        #controls { position: absolute; bottom: 20px; left: 20px; display: grid; grid-template-areas: ". u ." "l . r" ". d ."; gap: 8px; pointer-events: auto; }
        .btn-arrow { width: 48px; height: 48px; background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.2); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; }

        #actions { position: absolute; bottom: 25px; right: 25px; display: flex; flex-direction: column; gap: 15px; pointer-events: auto; }
        .btn-action { width: 85px; height: 85px; border-radius: 25px; border: none; color: white; font-weight: bold; box-shadow: 0 6px rgba(0,0,0,0.4); }

        /* MENU DE CRAFTING MELHORADO */
        .craft-panel { background: #1a1a1a; padding: 30px; border-radius: 25px; border: 4px solid #fb923c; width: 320px; text-align: center; color: white; }
        .recipe { background: #333; padding: 15px; border-radius: 15px; margin-bottom: 10px; display: flex; flex-direction: column; gap: 5px; pointer-events: auto; border: 1px solid #444; }
        .recipe:active { transform: scale(0.98); }
    </style>
</head>
<body>

    <div id="ui-menu" class="layer interactive">
        <h1 style="color:white; text-shadow: 0 4px #000;">PATO SURVIVAL V2.5</h1>
        <button class="btn-ui" onclick="game.startGame()">INICIAR JORNADA</button>
        <button class="btn-ui" style="background:#475569" onclick="game.toggleSettings(true)">CONFIGURA√á√ïES</button>
    </div>

    <div id="ui-settings" class="layer hidden interactive">
        <div class="craft-panel" style="border-color:#475569">
            <h3>AJUSTES</h3>
            <div style="margin:20px 0;">Cor do Pato: <input type="color" id="pColor" onchange="game.player.color = this.value" value="#ffffff"></div>
            <button class="btn-ui" style="width:100%" onclick="game.toggleSettings(false)">SALVAR</button>
        </div>
    </div>

    <div id="ui-crafting" class="layer hidden interactive">
        <div class="craft-panel">
            <h2 style="margin-top:0">‚öíÔ∏è BANCADA</h2>
            
            <div class="recipe" onclick="game.craftItem('table', 2)">
                <span>üì¶ Bancada de Trabalho</span>
                <small style="color:#22c55e">Custo: 2 Madeiras</small>
            </div>

            <div class="recipe" onclick="game.craftItem('fire', 3)">
                <span>üî• Fogueira</span>
                <small style="color:#22c55e">Custo: 3 Madeiras</small>
            </div>

            <button class="btn-ui btn-cancel" style="width:100%; margin-top:10px" onclick="game.toggleCraft(false)">FECHAR</button>
        </div>
    </div>

    <div id="ui-hud" class="layer hidden">
        <div class="hud-top">ü™µ Madeira: <span id="wood-txt">0</span></div>

        <div id="hotbar">
            <div class="slot active" onclick="game.setSlot(0)">ü™µ<div class="slot-count" id="s0-v">0</div></div>
            <div class="slot" onclick="game.setSlot(1)">üì¶<div class="slot-count" id="s1-v">0</div></div>
            <div class="slot" onclick="game.setSlot(2)">üî•<div class="slot-count" id="s2-v">0</div></div>
        </div>

        <div id="controls">
            <div class="btn-arrow" style="grid-area:u" id="b-u">‚ñ≤</div>
            <div class="btn-arrow" style="grid-area:l" id="b-l">‚óÄ</div>
            <div class="btn-arrow" style="grid-area:r" id="b-r">‚ñ∂</div>
            <div class="btn-arrow" style="grid-area:d" id="b-d">‚ñº</div>
        </div>

        <div id="actions">
            <button id="btn-place" class="btn-action hidden" style="background:#2563eb" onclick="game.placeObject()">üìç<br>COLOCAR</button>
            <button id="btn-open-craft" class="btn-action hidden" style="background:#fb923c" onclick="game.toggleCraft(true)">‚öíÔ∏è<br>ABRIR</button>
            <button class="btn-action" style="background:#5d4037" onclick="game.playerAction()">ü™ì<br>A√á√ÉO</button>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d', { alpha: false });

        const game = {
            state: 'MENU',
            player: { x: 1000, y: 1000, dir: 1, color: '#ffffff', wood: 0, table: 0, fire: 0, slot: 0 },
            camera: { x: 1000, y: 1000 },
            world: { seed: 999, removed: new Set(), objects: [] },
            keys: { u:0, d:0, l:0, r:0 },

            startGame() {
                this.state = 'PLAY';
                document.getElementById('ui-menu').classList.add('hidden');
                document.getElementById('ui-hud').classList.remove('hidden');
            },
            toggleSettings(s) { document.getElementById('ui-settings').classList.toggle('hidden', !s); },
            toggleCraft(s) { 
                this.state = s ? 'CRAFTING' : 'PLAY'; 
                document.getElementById('ui-crafting').classList.toggle('hidden', !s); 
            },
            setSlot(i) {
                this.player.slot = i;
                document.querySelectorAll('.slot').forEach((s, idx) => s.classList.toggle('active', idx === i));
                this.updateUI();
            },
            playerAction() {
                // Tenta coletar madeira
                const px = Math.floor(this.player.x/32)-2, py = Math.floor(this.player.y/32)-2;
                for(let x=px; x<=px+4; x++) {
                    for(let y=py; y<=py+4; y++) {
                        const id = `${x},${y}`;
                        if(this.getNoise(x,y) < 0.02 && !this.world.removed.has(id)) {
                            if(Math.hypot(this.player.x-(x*32+16), this.player.y-(y*32+16)) < 50) {
                                this.world.removed.add(id); this.player.wood++; this.updateUI(); return;
                            }
                        }
                    }
                }
            },
            craftItem(type, cost) {
                if(this.player.wood >= cost) {
                    this.player.wood -= cost;
                    this.player[type]++;
                    this.updateUI();
                    console.log("Crafted:", type);
                } else {
                    alert("Madeira insuficiente!");
                }
            },
            placeObject() {
                const p = this.player;
                if(p.slot === 1 && p.table > 0) { this.world.objects.push({x:p.x, y:p.y, type:'table'}); p.table--; }
                if(p.slot === 2 && p.fire > 0) { this.world.objects.push({x:p.x, y:p.y, type:'fire'}); p.fire--; }
                this.updateUI();
            },
            updateUI() {
                const p = this.player;
                document.getElementById('wood-txt').innerText = p.wood;
                document.getElementById('s0-v').innerText = p.wood;
                document.getElementById('s1-v').innerText = p.table;
                document.getElementById('s2-v').innerText = p.fire;
                const canPlace = (p.slot === 1 && p.table > 0) || (p.slot === 2 && p.fire > 0);
                document.getElementById('btn-place').classList.toggle('hidden', !canPlace);
            },
            getNoise(x, y) {
                const v = Math.sin(x * 12.98 + y * 78.23 + 999) * 43758.54;
                return v - Math.floor(v);
            }
        };

        // Input Setup
        const setupBtn = (id, k) => {
            const e = document.getElementById(id);
            e.ontouchstart = () => { game.keys[k] = 1; };
            e.ontouchend = () => { game.keys[k] = 0; };
        };
        setupBtn('b-u','u'); setupBtn('b-d','d'); setupBtn('b-l','l'); setupBtn('b-r','r');

        function draw() {
            const cw = canvas.width = window.innerWidth, ch = canvas.height = window.innerHeight;
            if(game.state === 'PLAY') {
                let mx = game.keys.r - game.keys.l, my = game.keys.d - game.keys.u;
                if(mx || my) {
                    const m = Math.hypot(mx,my);
                    game.player.x += (mx/m) * 3; game.player.y += (my/m) * 3;
                    if(mx !== 0) game.player.dir = mx > 0 ? 1 : -1;
                }
                game.camera.x = game.player.x - cw/2; game.camera.y = game.player.y - ch/2;
            }

            ctx.fillStyle = "#111"; ctx.fillRect(0,0,cw,ch);
            ctx.save(); ctx.translate(-game.camera.x, -game.camera.y);

            // Ch√£o e √Årvores
            const startX = Math.floor(game.camera.x/32)-1, endX = Math.ceil((game.camera.x+cw)/32)+1;
            const startY = Math.floor(game.camera.y/32)-1, endY = Math.ceil((game.camera.y+ch)/32)+1;
            for(let x=startX; x<=endX; x++) {
                for(let y=startY; y<=endY; y++) {
                    const n = game.getNoise(x,y);
                    ctx.fillStyle = n > 0.8 ? "#3d6e36" : "#457b3e";
                    ctx.fillRect(x*32, y*32, 33, 33);
                    if(n < 0.02 && !game.world.removed.has(`${x},${y}`)) {
                        ctx.fillStyle = "#4a2d18"; ctx.fillRect(x*32+12, y*32+16, 8, 12);
                        ctx.fillStyle = "#2d5a27"; ctx.fillRect(x*32+4, y*32-4, 24, 20);
                    }
                }
            }

            // Objetos Constru√≠dos
            let nearTable = false;
            game.world.objects.forEach(o => {
                if(o.type === 'table') {
                    ctx.fillStyle = "#5d4037"; ctx.fillRect(o.x-15, o.y-10, 30, 20);
                    if(Math.hypot(game.player.x-o.x, game.player.y-o.y) < 60) nearTable = true;
                } else {
                    ctx.fillStyle = "#7c2d12"; ctx.fillRect(o.x-10, o.y-2, 20, 5);
                    ctx.fillStyle = "#f97316"; ctx.beginPath(); ctx.arc(o.x, o.y-6, 7 + Math.random()*2, 0, 7); ctx.fill();
                }
            });
            document.getElementById('btn-open-craft').classList.toggle('hidden', !nearTable);

            // Pato
            ctx.fillStyle = game.player.color; ctx.fillRect(game.player.x-16, game.player.y-16, 32, 32);
            ctx.fillStyle = "#fb923c"; ctx.fillRect(game.player.x+(game.player.dir===1?12:-24), game.player.y-4, 12, 8);
            ctx.fillStyle = "black"; ctx.fillRect(game.player.x+(game.player.dir===1?6:-10), game.player.y-10, 4, 4);

            ctx.restore();
            requestAnimationFrame(draw);
        }
        draw();
    </script>
</body>
</html>
