<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <meta name="orientation" content="landscape">
    <link rel="manifest" href="manifest.json">
    <title>Pato Survival Alpha</title>
    <style>
        /* Reset total para evitar scroll */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; touch-action: none; outline: none; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Courier New', Courier, monospace; }
        
        /* Canvas Pixelado */
        canvas { display: block; width: 100%; height: 100%; image-rendering: pixelated; }

        /* UI - Camadas */
        .layer { position: absolute; inset: 0; pointer-events: none; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10; }
        .interactive { pointer-events: auto; }
        .hidden { display: none !important; }

        /* MENU ESTILO ALPHA 1.5.0 */
        #menu-screen { background: rgba(20, 30, 20, 0.95); z-index: 100; border: 4px solid #fb923c; }
        h1 { color: #fb923c; font-size: 3rem; text-shadow: 4px 4px #000; margin-bottom: 2rem; text-align: center; line-height: 1; }
        .btn {
            background: #334155; color: white; border: 3px solid #fb923c;
            padding: 15px 40px; font-size: 1.2rem; font-weight: bold;
            margin: 10px; cursor: pointer; box-shadow: 5px 5px 0 #000;
            text-transform: uppercase; letter-spacing: 2px;
        }
        .btn:active { transform: translate(3px, 3px); box-shadow: 2px 2px 0 #000; }

        /* HUD (Recursos) */
        #hud { position: absolute; top: 10px; left: 10px; z-index: 50; display: flex; gap: 10px; }
        .res-box { background: rgba(0,0,0,0.7); color: #fff; padding: 8px 15px; border-radius: 4px; border-left: 4px solid #fb923c; font-weight: bold; font-size: 18px; }

        /* CONTROLES MOBILE */
        #controls { position: absolute; bottom: 20px; left: 20px; width: 160px; height: 160px; z-index: 50; pointer-events: auto; }
        .dpad-btn { position: absolute; width: 50px; height: 50px; background: rgba(255,255,255,0.15); border: 2px solid rgba(255,255,255,0.3); border-radius: 8px; display: flex; justify-content: center; align-items: center; color: white; font-size: 20px; }
        .dpad-btn:active { background: rgba(255, 165, 0, 0.5); border-color: orange; }
        
        #btn-up { top: 0; left: 55px; }
        #btn-down { bottom: 0; left: 55px; }
        #btn-left { top: 55px; left: 0; }
        #btn-right { top: 55px; right: 0; }

        #action-btn { 
            position: absolute; bottom: 30px; right: 30px; 
            width: 90px; height: 90px; 
            background: #fb923c; border: 4px solid #fff; border-radius: 50%; 
            color: #fff; font-weight: bold; font-size: 14px;
            display: flex; justify-content: center; align-items: center;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            z-index: 50; pointer-events: auto;
        }
        #action-btn:active { transform: scale(0.95); background: #e27d26; }
    </style>
</head>
<body>

    <div id="menu-screen" class="layer interactive">
        <h1>PATO SURVIVAL<br><small style="font-size: 1.5rem; color: #fff;">ALPHA 1.5.0</small></h1>
        <button class="btn" onclick="startGame()">JOGAR</button>
        <button class="btn" style="filter: grayscale(1);">OP√á√ïES</button>
        <div style="margin-top: 20px; color: #888; font-size: 12px;">BUILD 2026 - GITHUB VERSION</div>
    </div>

    <div id="game-ui" class="hidden">
        <div id="hud">
            <div class="res-box">üå≤ <span id="wood">0</span></div>
            <div class="res-box">ü™® <span id="stone">0</span></div>
        </div>

        <div id="controls">
            <div class="dpad-btn" id="btn-up">‚ñ≤</div>
            <div class="dpad-btn" id="btn-down">‚ñº</div>
            <div class="dpad-btn" id="btn-left">‚óÄ</div>
            <div class="dpad-btn" id="btn-right">‚ñ∂</div>
        </div>

        <div id="action-btn">A√á√ÉO</div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        // CONFIGURA√á√ÉO
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        const state = {
            screen: 'MENU',
            player: { x: 500, y: 500, dir: 1, speed: 4 },
            cam: { x: 0, y: 0 },
            keys: { up: false, down: false, left: false, right: false },
            res: { wood: 0, stone: 0 },
            map: {}, // Armazena o que foi coletado
            time: 0
        };

        // INICIAR
        function startGame() {
            state.screen = 'GAME';
            document.getElementById('menu-screen').classList.add('hidden');
            document.getElementById('game-ui').classList.remove('hidden');
            // Tenta for√ßar fullscreen
            if (document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
            loop();
        }

        // CONTROLES DE TOQUE (D-PAD)
        const bindTouch = (id, key) => {
            const el = document.getElementById(id);
            el.addEventListener('touchstart', (e) => { e.preventDefault(); state.keys[key] = true; }, {passive: false});
            el.addEventListener('touchend', (e) => { e.preventDefault(); state.keys[key] = false; });
        };
        bindTouch('btn-up', 'up');
        bindTouch('btn-down', 'down');
        bindTouch('btn-left', 'left');
        bindTouch('btn-right', 'right');

        // BOT√ÉO DE A√á√ÉO
        const actionBtn = document.getElementById('action-btn');
        actionBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            interact();
            actionBtn.style.transform = "scale(0.9)";
        }, {passive: false});
        actionBtn.addEventListener('touchend', (e) => {
            actionBtn.style.transform = "scale(1)";
        });

        // L√ìGICA DE INTERA√á√ÉO (COLHETA)
        function interact() {
            const cx = Math.floor(state.player.x / 50);
            const cy = Math.floor(state.player.y / 50);

            // Verifica √°rea 3x3 ao redor do player
            for(let x = cx-1; x <= cx+1; x++) {
                for(let y = cy-1; y <= cy+1; y++) {
                    const key = `${x},${y}`;
                    if(state.map[key]) continue; // J√° coletado

                    // Gera√ß√£o procedural simples baseada na posi√ß√£o
                    const rng = Math.sin(x * 12.9898 + y * 78.233) * 43758.5453;
                    const type = Math.abs(rng - Math.floor(rng));

                    // Dist√¢ncia real
                    const dx = state.player.x - (x * 50 + 25);
                    const dy = state.player.y - (y * 50 + 25);
                    const dist = Math.sqrt(dx*dx + dy*dy);

                    if(dist < 50) {
                        if(type > 0.8) {
                            state.res.stone++;
                            state.map[key] = true;
                            updateHUD();
                            return; // Coleta um por vez
                        } else if(type > 0.5) {
                            state.res.wood++;
                            state.map[key] = true;
                            updateHUD();
                            return;
                        }
                    }
                }
            }
        }

        function updateHUD() {
            document.getElementById('wood').innerText = state.res.wood;
            document.getElementById('stone').innerText = state.res.stone;
        }

        // LOOP DO JOGO
        function loop() {
            if(state.screen !== 'GAME') return;
            
            const cw = canvas.width = window.innerWidth;
            const ch = canvas.height = window.innerHeight;
            state.time += 0.1;

            // Movimento
            if(state.keys.up) state.player.y -= state.player.speed;
            if(state.keys.down) state.player.y += state.player.speed;
            if(state.keys.left) { state.player.x -= state.player.speed; state.player.dir = -1; }
            if(state.keys.right) { state.player.x += state.player.speed; state.player.dir = 1; }

            // C√¢mera
            state.cam.x = state.player.x - cw / 2;
            state.cam.y = state.player.y - ch / 2;

            // Renderiza√ß√£o
            ctx.fillStyle = '#2d4a22'; // Grama Alpha
            ctx.fillRect(0, 0, cw, ch);

            ctx.save();
            ctx.translate(-state.cam.x, -state.cam.y);

            // Desenhar Mundo (Grid 50x50)
            const startX = Math.floor(state.cam.x / 50);
            const endX = startX + Math.ceil(cw / 50) + 1;
            const startY = Math.floor(state.cam.y / 50);
            const endY = startY + Math.ceil(ch / 50) + 1;

            for(let x = startX; x <= endX; x++) {
                for(let y = startY; y <= endY; y++) {
                    if(state.map[`${x},${y}`]) continue; // Se j√° foi pego, n√£o desenha

                    // Pseudo-aleat√≥rio fixo para cada coordenada
                    const rng = Math.abs(Math.sin(x * 12.9898 + y * 78.233) * 43758.5453) % 1;
                    
                    if(rng > 0.5) { // 50% de chance de ter algo
                        const px = x * 50 + 25;
                        const py = y * 50 + 25;
                        
                        // EFEITO DE TREMOR (SHAKE)
                        // Se o player estiver perto (< 60px), o objeto treme
                        const dist = Math.hypot(state.player.x - px, state.player.y - py);
                        let shakeX = 0;
                        if(dist < 60) {
                            shakeX = Math.sin(state.time * 5) * 3; // Treme 3px para os lados
                        }

                        if(rng > 0.8) {
                            // Rocha
                            ctx.fillStyle = '#64748b';
                            ctx.beginPath();
                            ctx.arc(px + shakeX, py, 15, 0, Math.PI*2);
                            ctx.fill();
                        } else {
                            // √Årvore
                            ctx.fillStyle = '#3e2723'; // Tronco
                            ctx.fillRect(px - 5 + shakeX, py, 10, 20);
                            ctx.fillStyle = '#1b5e20'; // Copa
                            ctx.beginPath();
                            ctx.arc(px + shakeX, py - 10, 20, 0, Math.PI*2);
                            ctx.fill();
                        }
                    }
                }
            }

            // Desenhar Player (Pato)
            ctx.fillStyle = '#fff';
            ctx.fillRect(state.player.x - 15, state.player.y - 15, 30, 30);
            // Bico
            ctx.fillStyle = '#fb923c';
            if(state.player.dir === 1) ctx.fillRect(state.player.x + 10, state.player.y - 5, 10, 8);
            else ctx.fillRect(state.player.x - 20, state.player.y - 5, 10, 8);
            // Olho
            ctx.fillStyle = '#000';
            if(state.player.dir === 1) ctx.fillRect(state.player.x + 5, state.player.y - 8, 4, 4);
            else ctx.fillRect(state.player.x - 9, state.player.y - 8, 4, 4);

            ctx.restore();

            requestAnimationFrame(loop);
        }
    </script>
</body>
</html>
