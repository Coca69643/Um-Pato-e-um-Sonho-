<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Pato Survival Alpha 1.5.1 - Fixes</title>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; touch-action: none; outline: none; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        canvas { display: block; width: 100%; height: 100%; image-rendering: pixelated; }

        /* --- MENU PRINCIPAL OTIMIZADO --- */
        #menu-screen { 
            position: absolute; inset: 0; z-index: 100; 
            background: radial-gradient(circle, #2d3f2d 0%, #0a0f0a 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            /* Borda removida conforme pedido */
            padding: 20px;
        }
        .alpha-title { 
            color: #fb923c; font-size: 32px; /* Reduzido */
            text-shadow: 3px 3px #000; text-align: center; margin-bottom: 25px; line-height: 1.1; 
            font-weight: 900;
        }
        .alpha-title small { font-size: 14px; color: #fff; letter-spacing: 3px; display: block; margin-top: 5px;}
        
        .menu-btns { display: flex; flex-direction: column; gap: 12px; width: 220px; /* Largura reduzida */ }
        .btn-alpha { 
            background: #1e293b; color: white; border: 2px solid #fb923c; padding: 12px; /* Padding reduzido */
            font-size: 14px; /* Fonte reduzida */
            cursor: pointer; font-weight: bold; text-transform: uppercase;
            box-shadow: 4px 4px 0 #000; transition: 0.1s; pointer-events: auto; border-radius: 4px;
        }
        .btn-alpha:active { transform: translate(2px, 2px); box-shadow: 2px 2px 0 #000; }
        .btn-alpha:disabled { opacity: 0.5; border-color: #475569; color: #475569; box-shadow: none; transform: none; }

        #version-log { position: absolute; bottom: 10px; left: 10px; color: #64748b; font-size: 10px; pointer-events: none; opacity: 0.7; }

        /* MODAL DE CONFIGURAÇÕES */
        #config-modal {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 260px; background: #1e293b; border: 2px solid #fb923c;
            padding: 20px; z-index: 110; display: flex; flex-direction: column; gap: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.8); color: white; text-align: center;
        }

        /* --- INTERFACE DO JOGO --- */
        #game-ui { position: absolute; inset: 0; pointer-events: none; z-index: 50; }
        #top-hud { position: absolute; top: 10px; width: 100%; display: flex; justify-content: center; }
        .time-box { background: rgba(0,0,0,0.8); color: #fb923c; padding: 5px 15px; border: 2px solid #fb923c; border-radius: 20px; font-weight: bold; font-size: 12px; }

        #hud { position: absolute; top: 10px; left: 10px; display: flex; gap: 8px; }
        .res-box { background: rgba(0,0,0,0.8); color: #fff; padding: 8px; border-left: 4px solid #fb923c; font-size: 14px; font-weight: bold; }

        #btn-inv { position: absolute; top: 10px; right: 10px; width: 60px; height: 45px; background: #334155; border: 2px solid #fb923c; color: white; display: flex; align-items: center; justify-content: center; pointer-events: auto; font-weight: bold; font-size: 12px; }
        
        #craft-panel { position: absolute; top: 60px; right: 10px; width: 180px; background: rgba(15,23,42,0.95); border: 2px solid #fb923c; padding: 10px; pointer-events: auto; color: white; }
        .craft-item { background: #1e293b; border: 1px solid #475569; padding: 8px; margin-bottom: 5px; font-size: 11px; cursor: pointer; display: flex; justify-content: space-between; }
        .craft-item:active { background: #fb923c; }

        /* HOTBAR */
        #hotbar { position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); display: flex; gap: 6px; background: rgba(0,0,0,0.8); padding: 6px; border: 2px solid #fb923c; pointer-events: auto; border-radius: 8px; }
        .slot { width: 40px; height: 40px; background: #1e293b; border: 2px solid #475569; display: flex; align-items: center; justify-content: center; color: white; font-size: 8px; font-weight: bold; text-align: center; border-radius: 4px; }
        .slot.selected { border-color: #fb923c; background: #334155; box-shadow: 0 0 10px #fb923c; }

        /* CONTROLES */
        #controls { position: absolute; bottom: 20px; left: 20px; width: 140px; height: 140px; pointer-events: auto; }
        .d-btn { position: absolute; width: 45px; height: 45px; background: rgba(255,255,255,0.1); border: 2px solid #fff; display: flex; align-items: center; justify-content: center; color: white; border-radius: 8px; font-size: 18px; }
        #b-u { top: 0; left: 47px; } #b-d { bottom: 0; left: 47px; } #b-l { top: 47px; left: 0; } #b-r { top: 47px; right: 0; }
        #btn-action { position: absolute; bottom: 25px; right: 25px; width: 80px; height: 80px; background: #fb923c; border: 4px solid #fff; border-radius: 50%; color: white; font-weight: bold; pointer-events: auto; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 15px rgba(251,146,60,0.5); font-size: 12px; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="menu-screen">
        <div class="alpha-title">PATO SURVIVAL<br><small>ALPHA 1.5.1</small></div>
        <div class="menu-btns">
            <button class="btn-alpha" onclick="newGame()">NOVO JOGO</button>
            <button class="btn-alpha" id="btn-continue" onclick="loadGame()" disabled>CONTINUAR</button>
            <button class="btn-alpha" onclick="toggleConfig()">CONFIGURAÇÕES</button>
        </div>
        <div id="version-log">BUILD: 1.5.1 - UI FIX</div>
    </div>

    <div id="config-modal" class="hidden">
        <div style="font-weight:bold; color:#fb923c; margin-bottom:10px">CONFIGURAÇÕES</div>
        <div style="font-size:12px; margin-bottom:15px">Som: Desativado (Alpha)</div>
        <button class="btn-alpha" onclick="resetSave()">LIMPAR SAVE</button>
        <button class="btn-alpha" onclick="toggleConfig()">FECHAR</button>
    </div>

    <div id="game-ui" class="hidden">
        <div id="top-hud"><div class="time-box">DIA <span id="day-val">1</span> - <span id="clock-val">08:00</span></div></div>
        <div id="hud">
            <div class="res-box">M: <span id="w-val">0</span></div>
            <div class="res-box">P: <span id="s-val">0</span></div>
        </div>
        <div id="btn-inv" onclick="toggleCraft()">INV</div>
        <div id="craft-panel" class="hidden">
            <div class="craft-item" onclick="doCraft('bench')"><span>BANCADA</span><span>10 M</span></div>
            <div class="craft-item" onclick="doCraft('torch')"><span>TOCHA</span><span>5 M</span></div>
            <div class="craft-item" onclick="doCraft('axe')"><span>MACHADO</span><span>5M 5P</span></div>
            <div class="craft-item" onclick="doCraft('pick')"><span>PICARETA</span><span>5M 5P</span></div>
        </div>
        <div id="hotbar">
            <div class="slot selected" id="s0">Mão</div>
            <div class="slot" id="s1">-</div>
            <div class="slot" id="s2">-</div>
            <div class="slot" id="s3">-</div>
            <div class="slot" id="s4">-</div>
        </div>
        <div id="controls"><div class="d-btn" id="b-u">▲</div><div class="d-btn" id="b-d">▼</div><div class="d-btn" id="b-l">◀</div><div class="d-btn" id="b-r">▶</div></div>
        <div id="btn-action">AÇÃO</div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let game = {
            active: false,
            player: { x: 1000, y: 1000, dir: 1, speed: 4, frame: 0 },
            cam: { x: 0, y: 0 },
            keys: { u:0, d:0, l:0, r:0, action: false },
            res: { wood: 0, stone: 0 },
            inv: { bench: 0, axe: false, pick: false, torch: false },
            built: [], mapHP: new Map(),
            selectedSlot: 0, time: 480, day: 1, isNearBench: false
        };

        // --- SISTEMA DE SAVE E MENU ---
        function checkSave() {
            if(localStorage.getItem('PatoSave_Alpha')) {
                document.getElementById('btn-continue').disabled = false;
                document.getElementById('btn-continue').innerText = "CONTINUAR (DIA " + JSON.parse(localStorage.getItem('PatoSave_Alpha')).day + ")";
            }
        }

        function toggleConfig() { document.getElementById('config-modal').classList.toggle('hidden'); }
        
        function resetSave() {
            if(confirm("Apagar todo o progresso?")) {
                localStorage.removeItem('PatoSave_Alpha');
                location.reload();
            }
        }

        function saveGame() {
            const saveData = {
                res: game.res, inv: game.inv, built: game.built,
                time: game.time, day: game.day, player: {x: game.player.x, y: game.player.y},
                mapHP: Array.from(game.mapHP.entries())
            };
            localStorage.setItem('PatoSave_Alpha', JSON.stringify(saveData));
        }

        function loadGame() {
            const raw = localStorage.getItem('PatoSave_Alpha');
            if(!raw) return;
            const data = JSON.parse(raw);
            Object.assign(game, data);
            game.mapHP = new Map(data.mapHP);
            startGame();
        }

        function newGame() {
            localStorage.removeItem('PatoSave_Alpha');
            startGame();
        }

        function startGame() {
            game.active = true;
            document.getElementById('menu-screen').classList.add('hidden');
            document.getElementById('game-ui').classList.remove('hidden');
            updateHUD();
            render();
            setInterval(saveGame, 10000);
        }

        // --- LÓGICA DE JOGO ---
        function toggleCraft() { document.getElementById('craft-panel').classList.toggle('hidden'); }

        function doCraft(item) {
            if(item === 'bench' && game.res.wood >= 10) { game.res.wood -= 10; game.inv.bench++; document.getElementById('s1').innerText = "Bancada"; }
            if(item === 'torch' && game.res.wood >= 5) { game.res.wood -= 5; game.inv.torch = true; document.getElementById('s4').innerText = "Tocha"; }
            if(game.isNearBench && game.res.wood >= 5 && game.res.stone >= 5) {
                if(item === 'axe') { game.inv.axe = true; document.getElementById('s2').innerText = "Machado"; }
                if(item === 'pick') { game.inv.pick = true; document.getElementById('s3').innerText = "Picareta"; }
            }
            updateHUD(); saveGame();
        }

        function handleAction() {
            if(game.selectedSlot === 1 && game.inv.bench > 0) {
                game.built.push({ x: game.player.x, y: game.player.y });
                game.inv.bench--; document.getElementById('s1').innerText = game.inv.bench > 0 ? "Bancada" : "-";
                return;
            }
            const px = Math.floor(game.player.x/60), py = Math.floor(game.player.y/60);
            for(let x=px-1; x<=px+1; x++) {
                for(let y=py-1; y<=py+1; y++) {
                    const id = `${x},${y}`;
                    const n = Math.abs(Math.sin(x*12.9 + y*78.2)*437) % 1;
                    if(n > 0.2) continue;
                    const dist = Math.hypot(game.player.x - (x*60+30), game.player.y - (y*60+30));
                    if(dist < 70) {
                        if(!game.mapHP.has(id)) game.mapHP.set(id, 6);
                        let dmg = 1;
                        if(n < 0.1 && game.inv.axe && game.selectedSlot === 2) dmg = 3;
                        if(n >= 0.1 && game.inv.pick && game.selectedSlot === 3) dmg = 3;
                        game.mapHP.set(id, game.mapHP.get(id) - dmg);
                        if(game.mapHP.get(id) <= 0) {
                            if(n < 0.1) game.res.wood += 2; else game.res.stone += 2;
                            game.mapHP.set(id, -1);
                        }
                        updateHUD(); return;
                    }
                }
            }
        }

        // --- RENDERIZAÇÃO MELHORADA ---
        function drawTree(ctx, x, y, shake) {
            // Tronco
            ctx.fillStyle = '#4a3728';
            ctx.fillRect(x - 5 + shake, y, 10, 15);
            // Copa "Pinheiro" (3 Triângulos)
            ctx.fillStyle = '#1e5128'; // Verde Escuro Base
            ctx.beginPath(); ctx.moveTo(x-15+shake, y); ctx.lineTo(x+shake, y-25); ctx.lineTo(x+15+shake, y); ctx.fill();
            ctx.fillStyle = '#2d6a32'; // Verde Médio Meio
            ctx.beginPath(); ctx.moveTo(x-12+shake, y-10); ctx.lineTo(x+shake, y-35); ctx.lineTo(x+12+shake, y-10); ctx.fill();
            ctx.fillStyle = '#4cae4c'; // Verde Claro Topo
            ctx.beginPath(); ctx.moveTo(x-8+shake, y-20); ctx.lineTo(x+shake, y-40); ctx.lineTo(x+8+shake, y-20); ctx.fill();
        }

        function drawRock(ctx, x, y, shake) {
            // Rocha Facetada (Polígono Irregular)
            ctx.fillStyle = '#64748b';
            ctx.beginPath();
            ctx.moveTo(x - 10 + shake, y + 5);
            ctx.lineTo(x - 15 + shake, y - 5);
            ctx.lineTo(x - 5 + shake, y - 15);
            ctx.lineTo(x + 10 + shake, y - 12);
            ctx.lineTo(x + 15 + shake, y + 5);
            ctx.lineTo(x + 5 + shake, y + 10);
            ctx.closePath();
            ctx.fill();
            
            // Detalhe de Luz
            ctx.fillStyle = '#94a3b8';
            ctx.beginPath(); ctx.arc(x - 5 + shake, y - 5, 3, 0, 7); ctx.fill();
        }

        function drawPato(ctx, x, y, dir, walking) {
            ctx.save(); ctx.translate(x, y);
            if(dir < 0) ctx.scale(-1, 1);
            const bob = Math.sin(game.player.frame) * 2;
            
            // Pato 2.5D
            ctx.fillStyle = 'rgba(0,0,0,0.3)'; ctx.beginPath(); ctx.ellipse(0, 14, 12, 6, 0, 0, 7); ctx.fill(); // Sombra
            ctx.fillStyle = '#ffffff'; ctx.beginPath(); ctx.ellipse(0, 0+bob, 16, 13, 0, 0, 7); ctx.fill(); // Corpo
            ctx.fillStyle = '#e2e8f0'; ctx.beginPath(); ctx.ellipse(-4, 2+bob, 8, 5, 0.2, 0, 7); ctx.fill(); // Asa
            ctx.fillStyle = '#ffffff'; ctx.beginPath(); ctx.arc(10, -8+bob, 10, 0, 7); ctx.fill(); // Cabeça
            ctx.fillStyle = '#fb923c'; ctx.beginPath(); ctx.moveTo(18, -10+bob); ctx.lineTo(26, -6+bob); ctx.lineTo(18, -2+bob); ctx.fill(); // Bico
            ctx.fillStyle = '#000'; ctx.beginPath(); ctx.arc(14, -10+bob, 2, 0, 7); ctx.fill(); // Olho
            ctx.restore();
        }

        function render() {
            if(!game.active) return;
            const cw = canvas.width = window.innerWidth, ch = canvas.height = window.innerHeight;
            game.time += 0.04;
            if(game.time >= 1440) { game.time = 0; game.day++; saveGame(); }

            let mx = game.keys.r - game.keys.l, my = game.keys.d - game.keys.u;
            if(mx||my) {
                game.player.x += mx * game.player.speed;
                game.player.y += my * game.player.speed;
                game.player.frame += 0.2;
                if(mx) game.player.dir = mx;
            } else { game.player.frame = 0; }
            
            game.cam.x = game.player.x - cw/2; game.cam.y = game.player.y - ch/2;

            ctx.fillStyle = '#1a3317'; ctx.fillRect(0,0,cw,ch);
            ctx.save(); ctx.translate(-game.cam.x, -game.cam.y);

            // MUNDO
            game.isNearBench = false;
            game.built.forEach(b => {
                if(Math.hypot(game.player.x - b.x, game.player.y - b.y) < 60) game.isNearBench = true;
                ctx.fillStyle = '#5d4037'; ctx.fillRect(b.x-25, b.y-10, 50, 25);
                ctx.fillStyle = '#a16207'; ctx.fillRect(b.x-25, b.y-10, 50, 5); // Detalhe topo
            });

            const sX = Math.floor(game.cam.x/60)-1, eX = sX + Math.ceil(cw/60)+2;
            const sY = Math.floor(game.cam.y/60)-1, eY = sY + Math.ceil(ch/60)+2;
            for(let x=sX; x<=eX; x++) {
                for(let y=sY; y<=eY; y++) {
                    const id = `${x},${y}`;
                    if(game.mapHP.get(id) === -1) continue;
                    const n = Math.abs(Math.sin(x*12.9 + y*78.2)*437) % 1;
                    const ox = x*60+30, oy = y*60+30;
                    const dist = Math.hypot(game.player.x - ox, game.player.y - oy);
                    let shake = (dist < 70 && game.keys.action) ? Math.sin(Date.now()*0.02)*4 : 0;

                    if(n < 0.05) { drawTree(ctx, ox, oy, shake); }
                    else if(n < 0.1) { drawRock(ctx, ox, oy, shake); }
                }
            }

            drawPato(ctx, game.player.x, game.player.y, game.player.dir, mx||my);
            ctx.restore();

            // LUZ NOTURNA
            let hr = game.time / 60;
            let dark = (hr < 6 || hr > 18) ? 0.75 : (hr > 16 || hr < 8) ? 0.3 : 0;
            ctx.fillStyle = `rgba(0,10,20,${dark})`;
            if(game.inv.torch && game.selectedSlot === 4) {
                ctx.save(); ctx.globalCompositeOperation = 'destination-out';
                let g = ctx.createRadialGradient(cw/2, ch/2, 20, cw/2, ch/2, 140);
                g.addColorStop(0, 'rgba(0,0,0,1)'); g.addColorStop(1, 'rgba(0,0,0,0)');
                ctx.fillStyle = g; ctx.beginPath(); ctx.arc(cw/2, ch/2, 140, 0, 7); ctx.fill(); ctx.restore();
            } else { ctx.fillRect(0,0,cw,ch); }

            requestAnimationFrame(render);
        }

        function updateHUD() {
            document.getElementById('w-val').innerText = game.res.wood;
            document.getElementById('s-val').innerText = game.res.stone;
            document.getElementById('day-val').innerText = game.day;
            let h = Math.floor(game.time/60)%24, m = Math.floor(game.time%60);
            document.getElementById('clock-val').innerText = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}`;
        }

        // INPUTS
        const bind = (id, k) => {
            const el = document.getElementById(id);
            el.ontouchstart = (e) => { e.preventDefault(); game.keys[k] = 1; };
            el.ontouchend = () => game.keys[k] = 0;
        };
        bind('b-u','u'); bind('b-d','d'); bind('b-l','l'); bind('b-r','r');
        const act = document.getElementById('btn-action');
        act.ontouchstart = (e) => { e.preventDefault(); game.keys.action = true; handleAction(); };
        act.ontouchend = () => game.keys.action = false;

        [0,1,2,3,4].forEach(i => {
            document.getElementById('s'+i).onclick = () => {
                document.querySelectorAll('.slot').forEach(s => s.classList.remove('selected'));
                document.getElementById('s'+i).classList.add('selected'); game.selectedSlot = i;
            };
        });
        
        checkSave();
    </script>
</body>
</html>
