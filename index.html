<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="manifest" href="manifest.json">
    <title>Pato Survival Alpha 1.5.0</title>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; touch-action: none; outline: none; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Courier New', Courier, monospace; }
        canvas { display: block; width: 100%; height: 100%; image-rendering: pixelated; }

        /* UI BASE */
        .layer { position: absolute; inset: 0; pointer-events: none; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10; }
        .interactive { pointer-events: auto; }
        .hidden { display: none !important; }

        /* MENU INICIAL ALPHA */
        #menu-screen { background: rgba(15, 25, 15, 0.98); z-index: 100; border: 6px double #fb923c; }
        h1 { color: #fb923c; font-size: 3rem; text-shadow: 4px 4px #000; margin-bottom: 20px; text-align: center; }
        .btn-alpha { 
            background: #334155; color: white; border: 3px solid #fb923c; 
            padding: 15px 40px; font-size: 1.2rem; cursor: pointer; 
            box-shadow: 5px 5px 0 #000; margin: 5px;
        }

        /* HUD E INVENTÁRIO */
        #hud { position: absolute; top: 10px; left: 10px; z-index: 50; display: flex; gap: 8px; }
        .res-box { background: rgba(0,0,0,0.8); color: #fff; padding: 10px; border-left: 4px solid #fb923c; font-size: 16px; }

        /* BOTÃO INV (O QUE VOCÊ PEDIU) */
        #btn-inv { 
            position: absolute; top: 10px; right: 10px; width: 70px; height: 50px; 
            background: #475569; border: 3px solid #fb923c; color: white; 
            font-weight: bold; z-index: 60; display: flex; align-items: center; justify-content: center;
            pointer-events: auto;
        }

        /* PAINEL DE CRAFTING */
        #craft-panel { 
            position: absolute; top: 70px; right: 10px; width: 220px; 
            background: rgba(30, 41, 59, 0.95); border: 3px solid #fb923c; 
            padding: 10px; z-index: 60; pointer-events: auto; color: white;
        }
        .craft-item { 
            background: #1e293b; border: 1px solid #475569; padding: 8px; 
            margin-bottom: 5px; font-size: 12px; cursor: pointer;
        }
        .craft-item:active { background: #fb923c; }

        /* CONTROLES */
        #controls { position: absolute; bottom: 20px; left: 20px; width: 150px; height: 150px; z-index: 50; pointer-events: auto; }
        .d-btn { position: absolute; width: 50px; height: 50px; background: rgba(255,255,255,0.1); border: 2px solid #fff; border-radius: 5px; display: flex; align-items: center; justify-content: center; color: white; }
        #b-u { top: 0; left: 50px; } #b-d { bottom: 0; left: 50px; } #b-l { top: 50px; left: 0; } #b-r { top: 50px; right: 0; }

        #btn-action { 
            position: absolute; bottom: 30px; right: 30px; width: 100px; height: 100px; 
            background: #fb923c; border: 5px solid #fff; border-radius: 50%; 
            color: #fff; font-weight: bold; z-index: 50; pointer-events: auto;
            display: flex; align-items: center; justify-content: center;
        }
    </style>
</head>
<body>

    <div id="menu-screen" class="layer interactive">
        <h1>PATO SURVIVAL<br><small>ALPHA 1.5.0</small></h1>
        <button class="btn-alpha" onclick="startGame()">INICIAR</button>
    </div>

    <div id="game-ui" class="hidden">
        <div id="hud">
            <div class="res-box">MADEIRA: <span id="w-val">0</span></div>
            <div class="res-box">PEDRA: <span id="s-val">0</span></div>
        </div>

        <div id="btn-inv" class="interactive" onclick="toggleCraft()">INV</div>

        <div id="craft-panel" class="hidden">
            <div style="font-size: 14px; margin-bottom: 10px; color: #fb923c;">CRAFTING ALPHA</div>
            <div class="craft-item" onclick="doCraft('bench')">BANCADA (10 Mad.)</div>
            <div class="craft-item" onclick="doCraft('axe')">MACHADO (5 Mad. + 5 Ped.)</div>
            <div class="craft-item" onclick="doCraft('pick')">PICARETA (5 Mad. + 5 Ped.)</div>
            <div id="inv-status" style="font-size: 10px; margin-top: 10px; color: #94a3b8;"></div>
        </div>

        <div id="controls">
            <div class="d-btn" id="b-u">▲</div><div class="d-btn" id="b-d">▼</div>
            <div class="d-btn" id="b-l">◀</div><div class="d-btn" id="b-r">▶</div>
        </div>
        <div id="btn-action">AÇÃO</div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        const game = {
            active: false,
            player: { x: 2000, y: 2000, dir: 1, speed: 5 },
            cam: { x: 0, y: 0 },
            keys: { u:0, d:0, l:0, r:0 },
            res: { wood: 0, stone: 0 },
            inv: { bench: false, axe: false, pick: false },
            map: new Set(),
            time: 0
        };

        function startGame() {
            game.active = true;
            document.getElementById('menu-screen').classList.add('hidden');
            document.getElementById('game-ui').classList.remove('hidden');
            render();
        }

        function toggleCraft() {
            document.getElementById('craft-panel').classList.toggle('hidden');
        }

        function doCraft(item) {
            const status = document.getElementById('inv-status');
            if(item === 'bench' && game.res.wood >= 10) {
                game.res.wood -= 10; game.inv.bench = true;
                status.innerText = "BANCADA CRIADA!";
            } else if(item === 'axe' && game.inv.bench && game.res.wood >= 5 && game.res.stone >= 5) {
                game.res.wood -= 5; game.res.stone -= 5; game.inv.axe = true;
                status.innerText = "MACHADO CRIADO!";
            } else if(item === 'pick' && game.inv.bench && game.res.wood >= 5 && game.res.stone >= 5) {
                game.res.wood -= 5; game.res.stone -= 5; game.inv.pick = true;
                status.innerText = "PICARETA CRIADA!";
            } else {
                status.innerText = "MATERIAIS INSUFICIENTES!";
            }
            updateUI();
        }

        function updateUI() {
            document.getElementById('w-val').innerText = game.res.wood;
            document.getElementById('s-val').innerText = game.res.stone;
        }

        // LÓGICA DE COLHEITA REALISTA (VOLTOU!)
        document.getElementById('btn-action').addEventListener('touchstart', (e) => {
            e.preventDefault();
            const px = Math.floor(game.player.x/60);
            const py = Math.floor(game.player.y/60);

            for(let x=px-1; x<=px+1; x++) {
                for(let y=py-1; y<=py+1; y++) {
                    const id = `${x},${y}`;
                    if(game.map.has(id)) continue;

                    const n = Math.abs(Math.sin(x*12.9 + y*78.2)*437) % 1;
                    if(n > 0.15) continue;

                    const dist = Math.hypot(game.player.x - (x*60+30), game.player.y - (y*60+30));
                    if(dist < 70) {
                        if(n < 0.07) game.res.wood += game.inv.axe ? 3 : 1;
                        else game.res.stone += game.inv.pick ? 3 : 1;
                        
                        game.map.add(id); // AGORA O OBJETO SOME
                        updateUI();
                        return;
                    }
                }
            }
        });

        const bind = (id, k) => {
            document.getElementById(id).ontouchstart = () => game.keys[k] = 1;
            document.getElementById(id).ontouchend = () => game.keys[k] = 0;
        };
        bind('b-u','u'); bind('b-d','d'); bind('b-l','l'); bind('b-r','r');

        function render() {
            if(!game.active) return;
            const cw = canvas.width = window.innerWidth, ch = canvas.height = window.innerHeight;
            game.time += 0.05;

            // Movimento
            let mx = game.keys.r - game.keys.l, my = game.keys.d - game.keys.u;
            if(mx||my) {
                game.player.x += mx * game.player.speed;
                game.player.y += my * game.player.speed;
                if(mx) game.player.dir = mx;
            }
            game.cam.x = game.player.x - cw/2; game.cam.y = game.player.y - ch/2;

            ctx.fillStyle = '#1a3317'; ctx.fillRect(0,0,cw,ch);
            ctx.save(); ctx.translate(-game.cam.x, -game.cam.y);

            // MUNDO
            const sX = Math.floor(game.cam.x/60)-1, eX = sX + Math.ceil(cw/60)+2;
            const sY = Math.floor(game.cam.y/60)-1, eY = sY + Math.ceil(ch/60)+2;

            for(let x=sX; x<=eX; x++) {
                for(let y=sY; y<=eY; y++) {
                    if(game.map.has(`${x},${y}`)) continue;
                    const n = Math.abs(Math.sin(x*12.9 + y*78.2)*437) % 1;
                    if(n > 0.15) continue;

                    const ox = x*60+30, oy = y*60+30;
                    const dist = Math.hypot(game.player.x - ox, game.player.y - oy);
                    let shake = (dist < 70) ? Math.sin(game.time * 10) * 4 : 0;

                    if(n < 0.07) { // ÁRVORE
                        ctx.fillStyle = '#3e2723'; ctx.fillRect(ox-4+shake, oy, 8, 12);
                        ctx.fillStyle = '#064e3b'; ctx.beginPath(); ctx.arc(ox+shake, oy-8, 16, 0, 7); ctx.fill();
                    } else { // ROCHA
                        ctx.fillStyle = '#475569'; ctx.beginPath(); ctx.arc(ox+shake, oy+10, 12, 0, 7); ctx.fill();
                    }
                }
            }

            // PATO
            ctx.fillStyle = 'white'; ctx.fillRect(game.player.x-15, game.player.y-15, 30, 30);
            ctx.fillStyle = '#fb923c'; ctx.fillRect(game.player.x + (game.player.dir > 0 ? 10 : -20), game.player.y-4, 10, 8);

            ctx.restore();
            requestAnimationFrame(render);
        }
    </script>
</body>
</html>
